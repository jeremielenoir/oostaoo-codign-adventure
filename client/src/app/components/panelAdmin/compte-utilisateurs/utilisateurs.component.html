<div id="global">
  <!--app-breadcrumb [namePage]="'Utilisateurs'"></app-breadcrumb-->
  <div *ngIf="dataRoute">
    <nav-wrapper-component [dataRoute]="this.dataRoute"></nav-wrapper-component>
  </div>
  <div id="content">
    <div id="shadow-cog" [ngClass]="{'shadow-cog-active': shadowcog1 == true}">
      <div id="remove" (click)="param_cog_non_active()"></div>
      <div class="modal">
        <div class="modal-header">
          <h3 class="modal-title" i18n>
            Add a user
          </h3>
          <button (click)="param_cog()">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
              <path
                d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
              </svg>
          </button>
        </div>
        <div class="modal-content">
          <form (ngSubmit)="addUser()" class="form" method="POST" #form>
            <div class="content-form-first">
              <div class="form-groupe">
                <div>
                  <mat-form-field [color]="'accent'" appearance="outline">
                    <mat-label i18n>Prénom</mat-label>
                    <input type="text" [formControl]="addPrenom" matInput value="" name="prenom" required />
                  </mat-form-field>
                  <div *ngIf=" submittedUser && addPrenom.invalid" class="alert">
                    <div *ngIf="addPrenom.errors.required" i18n>
                      Prénom requis
                    </div>
                  </div>
                </div>
              </div>
              <div class="form-groupe">
                <div>
                  <mat-form-field [color]="'accent'" appearance="outline">
                    <mat-label i18n>Nom</mat-label>
                    <input type="text" [formControl]="addNom" matInput value="" name="nom" required />
                  </mat-form-field>
                  <div *ngIf=" submittedUser && addNom.invalid" class="alert alert-danger">
                    <div *ngIf="addNom.errors.required" i18n>
                      Nom requis
                    </div>
                  </div>
                </div>
              </div>
              <div class="form-groupe">
                <div>
                  <mat-form-field [color]="'accent'" appearance="outline">
                    <mat-label i18n>E-mail</mat-label>
                    <input type="email" [formControl]="addEmail" matInput value="" name="email" required />
                  </mat-form-field>
                  <div *ngIf=" submittedUser && addEmail.invalid" class="alert alert-danger">
                    <div *ngIf="addEmail.errors.required" i18n>
                      Email requis
                    </div>
                    <div *ngIf="addEmail.errors.email" i18n>
                      Email valide requis
                    </div>
                  </div>
                </div>
              </div>
              <div class="form-groupe">
                <div>
                  <mat-form-field [color]="'accent'" appearance="outline">
                    <mat-label i18n>Pseudo</mat-label>
                    <input type="text" [formControl]="addUsername" matInput value="" name="username" required />
                  </mat-form-field>
                  <div *ngIf=" submittedUser && addUsername.invalid" class="alert alert-danger">
                    <div *ngIf="addUsername.errors.required" i18n>
                      Pseudo requis
                    </div>
                  </div>
                </div>
              </div>
              <div class="form-groupe">
                <div>
                  <mat-form-field [color]="'accent'" appearance="outline">
                    <mat-label i18n>Mot de passe</mat-label>
                    <input [formControl]="addPassword" type="password" name="password" matInput value="" required />
                  </mat-form-field>
                  <div *ngIf=" submittedUser && addPassword.invalid" class="alert alert-danger">
                    <div *ngIf="addPassword.errors.required" i18n>
                      Mot de passe requis
                    </div>
                  </div>
                </div>
              </div>
              <div class="form-groupe">
                <div>
                  <mat-form-field [color]="'accent'" appearance="outline">
                    <mat-label i18n>Confirmation du mot de passe</mat-label>
                    <input [formControl]="confirmPassword" type="password" name="confirmPassword" matInput value=""
                      required />
                  </mat-form-field>
                  <div *ngIf=" submittedUser && confirmPassword.invalid" class="alert alert-danger">
                    <div *ngIf="confirmPassword.errors.required" i18n>
                      Confirmation du mot de passe requis
                    </div>
                  </div>
                  <div *ngIf=" submittedUser && addPassword.value !== confirmPassword.value" class="alert alert-danger"
                    i18n>
                    Les mots de passe ne correspondent pas
                  </div>
                </div>
              </div>
              <div class="form-groupe">
                <div>
                  <mat-form-field appearance="outline" [color]="'accent'">
                    <mat-label i18n>Role</mat-label>
                    <mat-select (change)="roleSetted($event)" [formControl]="userrole" name="userrole">
                      <mat-option title="{{rol.description}}" *ngFor="let rol of rolesRef" [value]="rol.id">
                        {{ rol.name }}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                  <!-- <div *ngIf=" submittedUser && addPassword.invalid" class="alert alert-danger">
                    <div *ngIf="addPassword.errors.required">
                      Mot de passe requis
                    </div>
                  </div> -->
                </div>
              </div>
            </div>
            <div class="form-groupe">
              <div class="top-form-groupe">

              </div>
            </div>
            <div class="content-form-last">
              <div class="footer-form-last">
                <app-base-button type="submit" iconName="add">AJOUTER</app-base-button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
    <div id="shadow-cog-2" [ngClass]="{'shadow-cog-active': shadowcog2 == true}">
      <div id="remove-2" (click)="param_cog_non_active_deux()"></div>
      <div class="modal">
        <div class="modal-header">
          <h3 class="modal-title">Modifier l'utilisateur</h3>
        </div>
        <div class="modal-content">
          <form (ngSubmit)="updateUser()" class="form" method="PUT" #form>
            <div class="content-form-first">
              <div class="form-groupe">
                <div class="top-form-groupe">
                  <div class="title-and-error-span">
                    <label class="libele">prenom</label>
                  </div>
                </div>
                <div>
                  <input [formControl]="editPrenom" type="" value="{{editingUser?.prenom}}" class="champ-form" />
                  <div *ngIf=" modifiedUser && editPrenom.invalid" class="alert alert-danger">
                    <div *ngIf="editPrenom.errors.required">
                      Prénom requis
                    </div>
                  </div>
                </div>
              </div>
              <div class="form-groupe">
                <div class="top-form-groupe">
                  <div class="title-and-error-span">
                    <label class="libele">nom</label>
                  </div>
                </div>
                <div>
                  <input [formControl]="editNom" type="" class="champ-form" value="{{editingUser?.nom}}" />
                  <div *ngIf=" modifiedUser && editNom.invalid" class="alert alert-danger">
                    <div *ngIf="editNom.errors.required">
                      Nom requis
                    </div>
                  </div>
                </div>
              </div>
              <div class="form-groupe">
                <div class="top-form-groupe">
                  <div class="title-and-error-span">
                    <label class="libele">email</label>
                  </div>
                </div>
                <div>
                  <input [formControl]="editEmail" type="" value="{{editingUser?.email}}" class="champ-form" />
                  <div *ngIf=" modifiedUser && editEmail.invalid" class="alert alert-danger">
                    <div *ngIf="editEmail.errors.required">
                      Email requis
                    </div>
                    <div *ngIf="editEmail.errors.email">
                      Email valide requis
                    </div>
                  </div>
                </div>
              </div>
              <div class="form-groupe">
                <div class="top-form-groupe">
                  <div class="title-and-error-span">
                    <label class="libele">Pseudo</label>
                  </div>
                </div>
                <div>
                  <input [formControl]="editUsername" type="text" name="username" class="champ-form"
                    id="editUsername" />
                  <div *ngIf=" modifiedUser && editUsername.invalid" class="alert alert-danger">
                    <div *ngIf="editUsername.errors.required">
                      Pseudo requis
                    </div>
                  </div>
                </div>
              </div>
              <div class="form-groupe">
                <div class="top-form-groupe">
                  <div class="title-and-error-span">
                    <label class="libele">Mot de passe</label>
                  </div>
                </div>
                <div>
                  <input [formControl]="editPassword" type="password" name="password" class="champ-form"
                    id="editPassword" />
                  <div *ngIf=" modifiedUser && editPassword.invalid" class="alert alert-danger">
                    <div *ngIf="editPassword.errors.required">
                      Mot de passe requis
                    </div>
                  </div>
                </div>
              </div>
              <div class="form-groupe">
                <div class="top-form-groupe">
                  <div class="title-and-error-span">
                    <label class="libele">Confirmer le mot de passe</label>
                  </div>
                </div>
                <div>
                  <input [formControl]="confirmPassword" type="password" name="confirmPassword" class="champ-form"
                    id="confirmPassword" />
                  <div *ngIf=" modifiedUser && confirmPassword.invalid" class="alert alert-danger">
                    <div *ngIf="confirmPassword.errors.required">
                      Confirmation du mot de passe requis
                    </div>
                  </div>
                  <div *ngIf=" modifiedUser && editPassword.value !== confirmPassword.value" class="alert alert-danger">
                    Les mots de passe ne correspondent pas
                  </div>
                </div>
              </div>
              <div class="form-groupe">
                <div class="top-form-groupe">
                  <div class="title-and-error-span">
                    <label class="libele">Rôles</label>
                  </div>
                </div>
                <div>
                  <select (change)="roleSetted($event)" [formControl]="editUserrole" name="editUserrole"
                    class="select-role">
                    <option title="{{rol.description}}" *ngFor="let rol of rolesRef" [value]="rol.id">{{ rol.name }}
                    </option>
                  </select>
                  <!-- <div *ngIf=" submittedUser && addPassword.invalid" class="alert alert-danger">
                    <div *ngIf="addPassword.errors.required">
                      Mot de passe requis
                    </div>
                  </div> -->
                </div>
              </div>
            </div>
            <div class="content-form-last">
              <div class="footer-form-last">
                <button class="btn-gestion" type="submit">Sauvegarder</button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
    <div class="component-utilisateurs">
      <header class="header-form">
        <div class="champ-utilisateur">
          <form>
            <span class="icon-form-group-header-contenu"><i class="fas fa-search"></i></span>
            <input type="text" name="search" [(ngModel)]="searchText" class="input-champ-utilisateurs"
              placeholder="Filtrer par titre ou candidat" id="search-header">
          </form>
        </div>
        <div class="left-form-utilisateurs">
          <div class="nbr-utilisateurs">
            <i class="far fa-user btn-icon-utilisateur"></i>
            <span>Utilisateurs
              {{users && users.length ? users.length : '*'}}/{{users && users.length ? users.length : '*'}}</span>
          </div>
          <button class="btn-header-contenu" (click)="param_cog()">
            <i class="far fa-plus-square btn-icon" id="param-cog"></i> Ajouter utilisateur
          </button>
        </div>
      </header>
      <div class="table-info-user">
        <table class="table_user">
          <thead class="table_head">
            <tr class="table_row">
              <th class="table_head_cell">Nom</th>
              <th class="table_head_cell">Email</th>
              <th class="table_head_cell">Privileges</th>
              <th class="table_head_cell"></th>
            </tr>
          </thead>
          <tbody class="table_body">
            <tr class="table_row" *ngFor="let user of  users | search:'username,email':searchText"
              [ngClass]="{'user-disabled': user.blocked}">
              <td class="table_body_cell">{{user.username}}</td>
              <td class="table_body_cell">{{user.email}}</td>
              <td class="table_body_cell">{{user.role.name}}</td>
              <td class="table_body_cell table_icon">
                <i *ngIf="isCurrentUserIsAccountAdmin && !user.blocked" (click)="openForm(user)"
                  class="fas fa-pencil-alt icon"></i>
                <i *ngIf="isCurrentUserIsAccountAdmin && user.id !== currentUser.id && !user.blocked"
                  (click)=deleteUser(user) class="fas fa-ban icon"></i>
                <i *ngIf="isCurrentUserIsAccountAdmin && user.id !== currentUser.id && user.blocked"
                  (click)=enableUser(user) class="fas fa-check-circle icon"></i>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>