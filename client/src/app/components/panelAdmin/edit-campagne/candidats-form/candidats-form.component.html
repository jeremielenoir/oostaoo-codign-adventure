<div *ngIf="status === 'form'">
  <header mat-dialog-title class="header-modal">

    <div class="main-content-header">

      <div class="rond-custom">1</div>

      <div class="info-campaign-candidats">
        <h3 i18n>Inviter des candidats</h3>
        <p>Entrer le nom et l'email des candidats</p>
      </div>

    </div>

    <div class="close-invite-dialog">
      <span (click)="close()"> <mat-icon class="cross">close</mat-icon></span>
    </div>

  </header>
  
  <div class="content-modal-form">
    <div>
      <form [formGroup]="form">
        <mat-dialog-content>
        <div class="card-body" formArrayName="contacts">
          <div [formGroupName]="i" class="row" *ngFor="let contact of contacts.controls; let i = index">
            <div class="candidats__contact-inputs">
              <mat-form-field class="item" [color]="'accent'" appearance="outline" [floatLabel]="true">
                <mat-label>NOM et Prénom*</mat-label>
                <input formControlName="name" matInput placeholder="John Smith" type="text" />
              </mat-form-field>

              <mat-form-field class="item" [color]="'accent'" appearance="outline" [floatLabel]="true">
                <mat-label>Email*</mat-label>
                <input formControlName="value" matInput placeholder="john.smith@email.com" type="email" />
              </mat-form-field>
             
              <button  mat-mini-fab color="warn" (click)="removeContact(i)" [disabled]="contacts.length === 1">
                <mat-icon>delete</mat-icon>
              </button> 
            </div>
            <mat-hint *ngIf="hasApplied(i)" i18n>Ce
              candidat a
              déjà participé à cette
              campagne !</mat-hint>
          </div>
         
        </div>
      </mat-dialog-content>
      
      <div class="information" style=" display: flex; justify-content: space-between">
          Les champs indiqués par une * sont obligatoires
          <button mat-mini-fab (click)="addContact()" [disabled]="candidatsApplied$ | async" color="primary" aria-label="Example icon button with a delete icon">
            <mat-icon>person_add</mat-icon>
          </button>
        </div>
        <div class="block-button">
          <app-base-button iconName="mail_outline" [disabled]="!validate() || (candidatsApplied$ | async)"
            (clickEvent)="switchTo('email')">Prochaine
            étape : configurer l'email
          </app-base-button>
        </div>
      
      </form>
    </div>
  </div>

</div>

<div *ngIf="status === 'email'" class="modal-padding">
  <header mat-dialog-title class="header-modal">
    <div class="main-content-header">
    <div class="rond-custom">2</div>
    <div class="info-campaign-candidats">
      <h3>Configuration de l'email</h3>
      <p>Vous avez sélectionné <strong>{{candidats.length}}</strong> destinataire(s)</p>
    </div>
    </div>
  </header>
  
  <div class="content-modal-email">
    <div class="scroll-body">
      
      <div class="email-subject">
        
        <mat-form-field *ngIf="editing" class="email-subject-input" [color]="'accent'" appearance="outline"
          [floatLabel]="true">
          <mat-label>Sujet</mat-label>
          <input matInput placeholder="sujet" type="text" name="" [(ngModel)]="sujet" />
        </mat-form-field>
        
      </div> 
      <div [class.message-personaliser-form]="editing">
        
        <ckeditor *ngIf="editing" [editor]="Editor" [(ngModel)]="htmlContent"></ckeditor>
        
      </div> 
    </div>
    <div class="block-button">
      <app-base-button iconName="keyboard_arrow_left" iconPosition="left" 
        (clickEvent)="switchTo('form')">
        Retour
      </app-base-button>
     
      <app-base-button iconName="send"  (clickEvent)="updateCampaignPostCandidats()">
        Envoyer {{candidats.length > 1 ? "les emails" : "l'email"}}</app-base-button>
    </div>
  </div>
</div>


<div *ngIf="status === 'sent'" class="modal-padding">
  <div class="invitation-candidats">
    <div class="icon">
      <mat-icon class="md-48">
        task_alt
      </mat-icon>
    </div>
    <div class="content-modal-form">
      <p class="invit-desti">L'invitation a été envoyé avec succés à {{ candidats.length }} destinataire(s)</p>
      
      <div class="form-scroll">
        <mat-dialog-content>
        <table mat-table [dataSource]="candidats">
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef i18n> Name </th>
            <td mat-cell *matCellDef="let candidat"> {{ candidat.name | titlecase }} </td>
          </ng-container>
          <ng-container matColumnDef="email">
            <th mat-header-cell *matHeaderCellDef i18n> Email </th>
            <td mat-cell *matCellDef="let candidat"> {{ candidat.email }} </td>
          </ng-container>
          <ng-container matColumnDef="icon">
            <th mat-header-cell *matHeaderCellDef></th>
            <td mat-cell *matCellDef="let candidat">
              <mat-icon style="color:#4caf50">check</mat-icon>
            </td>
          </ng-container>
         <tr mat-row *matRowDef="let row; columns: displayedMatTableColumns;"></tr>
        </table>
      </mat-dialog-content>
      </div>

      <app-base-button class="submit-btn" (click)='retourCandidat()' iconName="close" i18n>Fermer</app-base-button>
    </div>
  </div>
</div>

<div *ngIf="status === 'loading'" class="loader-container modal-padding">
  <mat-spinner [strokeWidth]="20"></mat-spinner>
  <p class="margin-top-md" i18n>Envoi en cours...</p>
</div>
